---
import FooterDeferred from "../components/ui/FooterDeferred.astro";
import Navigation from "../components/ui/Navigation.astro";
import MainHead from "./MainHead.astro";

const { ...props } = Astro.props;
---

<html lang="en">
  <MainHead {...props} />
  <style>
    html.lenis {
      height: auto;
    }
    .lenis.lenis-smooth {
      scroll-behavior: auto;
    }
    .lenis.lenis-smooth [data-lenis-prevent] {
      overscroll-behavior: contain;
    }
    .lenis.lenis-stopped {
      overflow: hidden;
    }
  </style>
  <script src="../utils/lenis"></script>

  <!-- CRITICAL: Intercept colophon CSS immediately and defer it -->
  <script is:inline>
    (function() {
      const style = document.createElement('style');
      style.innerHTML = `
        link[href*="colophon"] {
          media: print !important;
        }
      `;
      document.head.prepend(style);

      // Watch for colophon CSS being injected
      const deferColophon = () => {
        Array.from(document.head.querySelectorAll('link[rel="stylesheet"]')).forEach(link => {
          if (link.href.includes('colophon')) {
            link.media = 'print';
            link.onload = link.onloadend = () => {
              link.media = 'all';
            };
            requestIdleCallback(() => link.onload?.());
          }
        });
      };

      // Run immediately
      deferColophon();

      // Watch for mutations (Astro might inject it later)
      new MutationObserver(deferColophon).observe(document.head, {
        childList: true,
      });
    })();
  </script>

  <body>
    <main>
      <Navigation />
      <slot />
    </main>
    <FooterDeferred />
  </body>
</html>
